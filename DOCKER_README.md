# Clementine Slack Bot - Docker Deployment

Simple Docker deployment for the Clementine Slack Bot with security best practices.

## 🔐 Security Features

- **Non-root user** execution (UID 1001)
- **Python dependency management** with pipenv
- **Minimal base image** using Red Hat UBI 9 Python 3.11
- **Health checks** for reliability

## 📋 Required Environment Variables

```bash
# Slack Configuration (Required)
SLACK_BOT_TOKEN=xoxb-your-bot-token-here
SLACK_SIGNING_SECRET=your-signing-secret-here  
SLACK_APP_TOKEN=xapp-your-app-token-here

# Tangerine API Configuration (Required)
TANGERINE_API_URL=https://your-tangerine-api.com
TANGERINE_API_TOKEN=your-api-token-here
```

## 🚀 Quick Start

### Using Docker Compose

```bash
# Create .env file with your secrets
cat > .env << EOF
SLACK_BOT_TOKEN=xoxb-your-actual-token
SLACK_SIGNING_SECRET=your-actual-secret
SLACK_APP_TOKEN=xapp-your-actual-token
TANGERINE_API_URL=https://your-tangerine-api.com
TANGERINE_API_TOKEN=your-actual-token
EOF

# Start the bot
docker-compose up -d

# View logs
docker-compose logs -f clementine-bot
```

### Using Docker Run

```bash
docker run -d \
  --name clementine-bot \
  --restart unless-stopped \
  -v clementine-data:/app/data \
  -e SLACK_BOT_TOKEN="your-token" \
  -e SLACK_SIGNING_SECRET="your-secret" \
  -e SLACK_APP_TOKEN="your-app-token" \
  -e TANGERINE_API_URL="https://your-api.com" \
  -e TANGERINE_API_TOKEN="your-api-token" \
  clementine-slack-bot:latest
```

## 🔧 Configuration

### Optional Environment Variables

```bash
# Bot Configuration
BOT_NAME=Clementine
ASSISTANT_LIST=konflux,assistant2
DEFAULT_PROMPT=You are a helpful assistant.

# Logging
LOG_LEVEL=INFO

# API Configuration  
TANGERINE_API_TIMEOUT=500

# Feature Flags
AI_DISCLOSURE_ENABLED=true
AI_DISCLOSURE_TEXT=This response was generated by AI.
FEEDBACK_ENABLED=true
```

## 🏗️ Building the Image

```bash
# Build locally
docker build -t clementine-slack-bot .

# Build and tag for registry
docker build -t your-registry/clementine-slack-bot:latest .
docker push your-registry/clementine-slack-bot:latest
```

## 📊 Monitoring

### Health Check

The container includes a health check that monitors the Python process:

```bash
# Check health status
docker inspect clementine-bot --format='{{.State.Health.Status}}'

# View logs
docker logs -f clementine-bot
```

### Resource Usage

```bash
# Monitor resource usage
docker stats clementine-bot

# View container details
docker inspect clementine-bot
```

## 🐛 Troubleshooting

### Container Won't Start

```bash
# Check container logs
docker logs clementine-bot

# Check if environment variables are set
docker exec clementine-bot env | grep SLACK
```

### Bot Not Responding

1. Verify the container is running: `docker ps`
2. Check the logs: `docker logs clementine-bot`
3. Ensure all required environment variables are set

### Permission Issues

```bash
# The container runs as UID 1001, ensure volumes have correct permissions
sudo chown -R 1001:1001 ./data
```

## 🔄 Updates

```bash
# Pull new image
docker pull your-registry/clementine-slack-bot:latest

# Restart with new image
docker-compose down
docker-compose up -d

# Or with docker run
docker stop clementine-bot
docker rm clementine-bot
# Run with new image...
```

## 💾 Data Storage

The bot uses `/app/data` for persistent storage. Mount a volume to preserve data across container restarts.

## 🔒 Security Notes

- Container runs as non-root user (UID 1001)
- Uses official Red Hat UBI base image
- No ports exposed (Slack Socket Mode uses outbound connections only)
- Environment variables should be managed securely in production

---

Simple, secure, and ready to deploy! 🎯 